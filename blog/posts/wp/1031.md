<!--
author: vaster
date: 2015-09-11 00:48:32
title: 【Linux进阶】利用iptables做代理
tags: iptables,Linux,nat
category: Linux,工作总结
status: publish
summary: 一直在负责海外的项目，有时候访问国外的某个统计系统或其他业务时，速度特别慢，这时，需求方要求我们给他做加速。这种情况下，一个最方便的方法就是使用iptables的NAT做代理来实现。实现方法：(代理机x.x.x.x，这个机器通常选择香港的机器)1. 开启系统的ip转发#sysct
-->

一直在负责海外的项目，有时候访问国外的某个统计系统或其他业务时，速度特别慢，这时，需求方要求我们给他做加速。这种情况下，一个最方便的方法就是使用iptables的NAT做代理来实现。

实现方法：

(代理机x.x.x.x，这个机器通常选择香港的机器)

1. 开启系统的ip转发

#sysctl -w net.ipv4.ip_forward=1

2. 添加访问的规则
<pre class="lang:vim decode:true"># Generated by iptables-save v1.3.5 on Tue Jan 27 14:55:31 2015
*nat
:PREROUTING ACCEPT [2308135:172237250]
:POSTROUTING ACCEPT [852905:57536025]
:OUTPUT ACCEPT [852905:57536025]
-A PREROUTING -d x.x.x.x -p tcp -m tcp --dport 1080 -j DNAT --to-destination x1.x1.x1.x1:80
-A POSTROUTING -d x1.x1.x1.x1 -p tcp -m tcp --dport 80 -j MASQUERADE
COMMIT
# Completed on Tue Jan 27 14:55:31 2015</pre>
(目的机x1.x1.x1.x1)

3. 防火墙开通代理机访问本机80

访问方法：

直接在浏览器输入x.x.x.x:1080即可实现访问x1.x1.x1.x1:80

&nbsp;
<div></div>
<div></div>
<div></div>
&nbsp;